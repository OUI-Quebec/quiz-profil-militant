@if (profils() && profils().length > 0) {
<div class="resultats-container">
  <div class="container">
    <div class="header-section">
      <app-lottie-emoji [emojiCode]="'1f389'"
        [size]="80"
        class="celebration"
       />
      <h1 class="titre-principal">Tes r√©sultats sont pr√™ts !</h1>
      <p class="sous-titre">
        D√©couvre ton profil militant et comment tu contribues au mouvement
      </p>
    </div>

    @if (profilPrincipal) {
    <div class="profil-principal">
      <div class="profil-hero" (click)="ouvrirDialogProfil(profilPrincipal)">
        <div class="profil-badge">Ton profil principal</div>
        <div
          class="profil-image-placeholder"
          [style.background-color]="getCouleurPourProfil(profilPrincipal.nom)"
        >
          <app-lottie-emoji [emojiCode]="getEmojiCodePourProfil(profilPrincipal.nom)"
            [size]="64"
            class="profil-emoji"
           />
        </div>
        <h2 class="profil-titre">
          {{ profilPrincipal.nom }} -
          {{ getDescriptionCourtePourProfil(profilPrincipal.nom) }}
        </h2>
        <div class="profil-score">
          <span class="score-numero">{{ profilPrincipal.score }}</span>
          <span class="score-label">r√©ponses correspondantes</span>
        </div>
        <p class="profil-description">
          {{ getDescriptionLonguePourProfil(profilPrincipal.nom) }}
        </p>

        <div class="profil-conseils">
          <h3>Comment t'impliquer davantage ?</h3>
          <ul>
            @for (conseil of getConseilsPourProfil(profilPrincipal.nom); track
            conseil) {
            <li>{{ conseil }}</li>
            }
          </ul>
        </div>
      </div>
    </div>
    } @if (autresProfils.length > 0) {
    <div class="autres-profils">
      <h3 class="section-titre">Tes autres traits militants</h3>
      <div class="profils-grid">
        @for (profil of autresProfils; track profil.nom; let i = $index) {
        <div
          class="profil-card"
          [style.animation-delay.ms]="i * 100"
          (click)="ouvrirDialogProfil(profil)"
        >
          <div
            class="profil-mini-icon"
            [style.background-color]="getCouleurPourProfil(profil.nom)"
          >
            <app-lottie-emoji [emojiCode]="getEmojiCodePourProfil(profil.nom)"
              [size]="48"
             />
          </div>
          <h4 class="profil-mini-titre">{{ profil.nom }}</h4>
          <div class="profil-mini-score">{{ profil.score }} pts</div>
          <div class="profil-barre">
            <div
              class="profil-barre-remplie"
              [style.background-color]="getCouleurPourProfil(profil.nom)"
              [style.width.%]="
                profilPrincipal
                  ? (profil.score / profilPrincipal.score) * 100
                  : 0
              "
            ></div>
          </div>
        </div>
        }
      </div>
    </div>
    }

    <div class="partage-section">
      <h3>Partage tes r√©sultats</h3>
      <div class="partage-actions">
        <button class="btn-partage btn-twitter" (click)="partagerSurX()">
          <span class="btn-icon">ùïè</span>
          <span class="btn-text">(Twitter)</span>
        </button>
        <button
          class="btn-recommencer"
          (click)="recommencerQuiz()"
          (mouseenter)="onHoverRefaire(true)"
          (mouseleave)="onHoverRefaire(false)"
        >
          <span class="btn-icon">
            <app-lottie-emoji #refaireLottie
              [emojiCode]="'1f91a'"
              [size]="20"
              [loop]="false"
              [autoplay]="false"
             />
          </span>
          <span class="btn-text">Refaire le quiz</span>
        </button>
      </div>
    </div>

    <div class="engagement-section">
      <div class="engagement-card">
        <h3>Pr√™t¬∑e √† t'engager pour de vrai ?</h3>
        <p>
          Rejoins les OUI Qu√©bec et mets tes talents au service de
          l'ind√©pendance !
        </p>
        <div class="engagement-actions">
          <a
            href="https://www.ouiquebec.org/benevole"
            target="_blank"
            class="btn-engagement"
            (mouseenter)="onHoverImplication(true)"
            (mouseleave)="onHoverImplication(false)"
          >
            <span class="btn-text">Implique toi!</span>
            <span class="btn-icon">
              <app-lottie-emoji #implicationLottie
                [emojiCode]="'1f449'"
                [size]="24"
                [loop]="false"
                [autoplay]="false"
               />
            </span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="resultats-background">
    <div class="confetti">
      @for (item of [].constructor(20); track $index; let idx = $index) {
      <div class="confetti-piece" [style.animation-delay.ms]="idx * 100"></div>
      }
    </div>
  </div>

  <!-- Dialogue pour les d√©tails du profil -->
  <app-profil-dialog [profil]="profil()!"
    [isOpen]="isDialogOpen()"
    (close)="fermerDialog()"
   />

  <!-- Dialogue de confirmation pour recommencer -->
  <app-dialog-confirmation [isVisible]="showDialogRecommencer()"
    titre="Recommencer le quiz"
    message="Es-tu s√ªr¬∑e de vouloir recommencer le quiz ? Toute ta progression sera perdue."
    texteConfirmer="Recommencer"
    texteAnnuler="Annuler"
    (confirmer)="confirmerRecommencer()"
    (annuler)="annulerRecommencer()"
   />
</div>
}
